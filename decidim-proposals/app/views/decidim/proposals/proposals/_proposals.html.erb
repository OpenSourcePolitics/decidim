<div class="collection-sort-controls row small-up-1 medium-up-3 card-grid">
  <div class="column">
    <%= order_selector available_orders, i18n_scope: "decidim.proposals.proposals.orders" %>
  </div>

  <div class="column">
    <%= render partial: "decidim/shared/results_per_page" %>
  </div>
</div>

<div class="row small-up-1 medium-up-2 card-grid">
  <%= render @proposals %>
</div>
<%= decidim_paginate @proposals, random_seed: random_seed %>

<script>
	var target_lang = "<%= current_user.locale.upcase %>";
	function decodeHtml(html) {
		var txt = document.createElement("textarea");
		txt.innerHTML = html;
		return txt.value;
	}
	function trad_card(param) {
	    param = param.parent().parent();
	    title = param.find(".card__title");
	    body = param.find("p");
	    trad_btn = param.find("#see-trad");
	    hidden_title = param.find(".hidden_title");
	    hidden_body = param.find(".hidden_body");
	    target_lang = "<%= current_user.locale.upcase %>";

	    if (hidden_title.text() !== "") {
	    	title.text(hidden_title.text());
	    	body.text(hidden_body.text());
	    	trad_btn.text("<%= t('.show_traduction') %>");
	    	hidden_title.text("");
	    } else {
	    	get_traduction(title.text(), target_lang, function(converted_title) {
	    		get_traduction(body.text(), target_lang, function(converted_body) {
	    			trad_btn.text(decodeHtml("<%= t('.show_the_original') %>" + " (" + converted_body[0] + ")"));
	    			hidden_title.text(title.text());
	    			hidden_body.text(body.text());
	    			title.text(converted_title[1]);
	    			body.text(converted_body[1]);
	    		});
	    	});
	    }
	}
	function get_traduction(original_text, target_lang, callback) {
		$.ajax({
			url : "/api/traduction",
			type : 'GET',
			data : "target=" + target_lang + "&original=" + original_text,
			dataType : 'json',
			success : function(body, status) {
				callback([body["translations"][0]["detected_source_language"], body["translations"][0]["text"]]);
			},
			error : function(body, status, error) {
				console.log(status + error);
			}
		});
	}
  
</script>
