<div class="card">
  <div class="card-divider">
    <h2 class="card-title">
      <%= t(".title") %>

      <div class="card__filter">
        <%= link_to t("actions.pending_moderation", scope: "decidim.upstream_moderations"), upstream_moderations_path %>
        |
        <%= link_to t("actions.not_visible", scope: "decidim.upstream_moderations"), upstream_moderations_path(not_visible: true) %>
        |
        <%= link_to t("actions.visible", scope: "decidim.upstream_moderations"), upstream_moderations_path(visible: true) %>
      </div>
    </h2>
  </div>

  <div class="card-section">
    <div class="table-scroll">
      <table class="table-list">
        <thead>
        <tr>
          <th><%= t("models.upstream_moderation.fields.reportable", scope: "decidim.upstream_moderations") %></th>
          <th><%= t("models.upstream_moderation.fields.user", scope: "decidim.upstream_moderations") %></th>
          <th><%= t("models.upstream_moderation.fields.reportable_title", scope: "decidim.upstream_moderations") %></th>
          <th><%= t("models.upstream_moderation.fields.reported_content_url", scope: "decidim.upstream_moderations") %></th>
          <% unless params[:visible] %>
            <th class="actions"><%= t("actions.change_visibility", scope: "decidim.upstream_moderations") %></th>
          <% end %>
        </tr>
        </thead>
        <tbody>
        <% upstream_moderations.each do |upstream_moderation| %>
          <tr data-id="<%= upstream_moderation.id %>">
            <td class="reportable-type">
              <%= upstream_moderation.upstream_reportable.class.name.demodulize %>
            </td>
            <td>
              <% if upstream_moderation.upstream_reportable.try(:author) %>
                <%= link_to upstream_moderation.upstream_reportable.author.name, current_or_new_conversation_path_with(upstream_moderation.upstream_reportable.author) %>
              <% elsif upstream_moderation.upstream_reportable.try(:authors) %>
                <%= link_to upstream_moderation.upstream_reportable.authors.first.name, current_or_new_conversation_path_with(upstream_moderation.upstream_reportable.authors.first) %>
              <% end %>
            </td>
            <td>
              <div class="reportable-content">
                <%= (upstream_moderation.upstream_reportable.try(:title) || upstream_moderation.upstream_reportable.try(:body)) %>
              </div>
            </td>
            <td>
              <%=
                link_to t("models.upstream_moderation.fields.visit_url", scope: "decidim.upstream_moderations"), upstream_moderation.upstream_reportable.reported_content_url
              %>
            </td>
            <% if params[:hidden] %>
              <td>
                <%= l(upstream_moderation.hidden_at, format: :long) if upstream_moderation.hidden_at.present? %>
              </td>
            <% end %>
            <% unless params[:visible] %>
              <td class="actions">
                <% unless params[:not_visible] %>
                  <% if allowed_to?(:hide, :moderation) %>
                    <%= icon_link_to "circle-x",
                                     hide_upstream_moderation_path(id: upstream_moderation),
                                     t("actions.hide", scope: "decidim.upstream_moderations"),
                                     class: "action-icon--check",
                                     method: :put
                    %>
                  <% end %>
                <% end %>
                <% if allowed_to?(:accept, :moderation) %>
                  <%= icon_link_to "check",
                                   accept_upstream_moderation_path(id: upstream_moderation),
                                   t("actions.accept", scope: "decidim.upstream_moderations"),
                                   class: "action-icon--check",
                                   method: :put %>
                <% end %>
              </td>
            <% end %>
          </tr>
        <% end %>
        </tbody>
      </table>
    </div>
  </div>
</div>
